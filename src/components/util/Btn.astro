---
const { href, txt, modifier=null, disabled=false } = Astro.props

const ExLink = ({ href }: { href: string }) => {
  const isExternal = href.startsWith('http://') || href.startsWith('https://') || /\.[a-zA-Z0-9]{2,}$/.test(href);
  return isExternal ? '_blank' : undefined;
};

const BtnTag = disabled ? 'span' : 'a';
---

<BtnTag href={disabled ? undefined : href} inert={disabled} class={`btn${
    Array.isArray(modifier)
      ? modifier.map(m => ` btn--${m}`).join('')
      : modifier ? ` btn--${modifier}` : ''
  }`} target={ExLink({ href })}>
  {txt && txt}
  {!disabled && 
    <span class="icon-arrow"></span>
  }
</BtnTag>

<style>
  @layer components {
    .btn {
      --this_bg: var(--color_white);
      --this_color: var(--color_primary);
      --this_hover_transition: var(--transition_hover);
      background-color: var(--this_bg);
      color: var(--this_color);
      min-width: var(--this_base_width, 290px);
      min-height: var(--this_base_height, 66px);
      border: 1px solid var(--color_primary);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 9999px;
      font-size: var(--this_font_size, rem(18));
      font-weight: 700;
      font-feature-settings: 'palt' on;
      letter-spacing: 0.02em;
      transition: background-color var(--this_hover_transition, 0.3s ease), color var(--this_hover_transition, 0.3s ease), border-color var(--this_hover_transition, 0.3s ease);
      @media (--hover) {
        &:hover {
          --this_bg: var(--color_primary);
          --this_color: var(--color_white);
          border-color: var(--this_color);
          .icon-arrow {
            &:before {
              mask-position: var(--this_arrow_size) center;
            }
          }
        }
      }
      &[inert] {
        --this_bg: #555;
        --this_color: #fff;
      }
    }
    .btn--kv {
      --this_base_width: 360px;
      --this_base_height: 72px;
    }
    .btn--fix {
      --this_base_width: 280px;
      pointer-events: var(--this_toggle_btn, none);
    }
    .btn--header {
      --this_bg: var(--color_primary);
      --this_color: var(--color_white);
      --this_base_width: 200px;
      --this_base_height: 48px;
      --this_font_size: rem(14);
      &:hover {
        --this_bg: var(--color_white);
        --this_color: var(--color_primary);
      }
      .icon-arrow {
        --this_arrow_size: 10px;
        width: 16px;
      }
    }
    .btn--wide {
      --this_base_width: 360px;
      --this_base_height: 72px;
      --this_font_size: rem(16);
    }
    .btn--arrow-right {
      .icon-arrow {
        rotate: 45deg;
      }
    }
    .icon-arrow {
      --this_arrow_size: 12px;
      width: 1.0em;
      aspect-ratio: 1;
      display: inline-block;
      aspect-ratio: 1;
      color: inherit;
      background-color: currentColor;
      margin-left: 0.8em;
      margin-right: -0.2em;
      position: relative;
      border-radius: 50%;
      &:before {
        content: '';
        position: absolute;
        inset: 0;
        margin: auto;
        width: var(--this_arrow_size);
        height: auto;
        aspect-ratio: 1;
        min-width: 0;
        mask-image: url('/assets/common/icon_arrow.svg');
        mask-size: contain;
        mask-repeat: repeat-x;
        mask-position: center center;
        rotate: -45deg;
        background-color: var(--this_bg);
        transition: mask-position var(--this_hover_transition, 0.3s ease);
      }
    }
    @media (--pc) {
      :global(.is-inversion) {
        .btn--header {
          --this_bg: var(--color_white);
          --this_color: var(--color_primary);
          @media (--hover) {
            &:hover {
              --this_bg: var(--color_primary);
              --this_color: var(--color_white);
            }
          }
        }
      }
    }
    @media(--under-pc) {
      .btn--header {
        --this_font_size: min(vw(16), 16px);
        width: 100%;
      }
      :global(.is-active) {
        .btn--header {
          --this_bg: var(--color_white);
          --this_color: var(--color_primary);
        }
      }
    }
    @media (--sp) {
      .btn {
        min-width: auto;
        width: stretch;
        min-height: 58px;
        font-size: rem(16);
      }
      .btn--kv {
        --this_base_width: stretch;
      }
      .btn--fix {
        --this_bg: var(--color_primary);
        --this_color: var(--color_white);
      }
    }
  }
</style>
